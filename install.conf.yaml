# Default options for dotbot commands like "link"
- defaults:
    link:
      relink: true
    shell:
      stdout: true
      stderr: true

# Cleans up dead symlinks in ~
- clean: ['~']

- shell:
  - [export USE_VSCODE_INSIDERS=yes, Exporting USE_VSCODE_INSIDERS]
  - [git submodule update --init --recursive, Downloading submodules]
  - [./write_defaults, Setting OS X defaults]
  - [./install_homebrew, Installing Homebrew]
  - [brew tap homebrew/bundle, Installing Homebrew bundle installer]
  - [brew install mas, Installing mas]
  - [./install_app_store_apps, Installing App Store apps (in background)]
  - [xcode-select --install || true, Installing Xcode command line tools]
  - [brew bundle -v, Installing Homebrew formulae]
  - [./install_extra_brews, Installing extra Homebrew formulae]
  - [brew unlink python, "Unlinking Python for MacVim's sake (https://github.com/Valloric/YouCompleteMe/issues/18)"]
  - [./install_iterm2, Installing iTerm2]
  - [./change_shell_to_zsh, Changing shell to zsh]
  - [./install_macvim, Installing MacVim]
  - [./install_vim_bundles, Installing vim bundles]
  - [./install_dash, Installing Dash]
  - [./install_unaphy_dependencies, Installing Unaphy dependencies]
  - [./install_dotnet_sdk, Installing .NET SDK]
  - [./install_vscode, Installing VSCode]
  - [./install_vscode_extensions, Installing VSCode extensions]
  - [./configure_ssh_config, Configuring SSH]
  - [./configure_nvalt, Configuring nvALT]
  - [./configure_macvim, Configuring MacVim]
  - [./configure_omnisharp, Configuring OmniSharp]
  - [./configure_unity, Configuring Unity]
  - [./configure_dash, Configuring Dash]
  - [./configure_chrome, Configuring Chrome]
  - [./configure_global_preferences, Configuring global preferences]
  - [./configure_by_host_global_preferences, Configuring by-host global preferences]
  - [./configure_power_management, Configuring power management]
  - [./configure_finder_favorites, Configuring Finder favorites]
  - [./configure_desktop, Configuring desktop]
  - [./configure_spotlight, Configuring Spotlight]
  # TODO:
  # - Remote Login
  # - Remote Management
  # - Insomnia configuration, and run immediately and on start, and grant security permissions
  # - Run BetterSnapTool immediately and on start, and grant security permissions
  # - Chrome extensions:
  #   - 1Password
  #   - Gleebox
  # iMessage text/emoji replacement

- link:
    ~/.oh-my-zsh: oh-my-zsh
    /usr/local/bin/mvim: /Applications/MacVim.app/Contents/bin/mvim
    ~/.vim: vim
    ~/.vimrc: vimrc
    ~/.zshrc: zshrc
    ~/.zsh_custom: zsh_custom
    ~/bin: bin
    ~/.omnisharp: omnisharp
    ~/Library/Application Support/Code/User:
      force: true
      create: true
      path: vscode
    ~/Library/Application Support/Code - Insiders/User:
      force: true
      create: true
      path: vscode
    ~/.gitconfig: gitconfig
    ~/.gitignore_global: gitignore_global
    ~/.iTerm2: iTerm2
    ~/Library/Preferences/com.apple.dock.plist:
      force: true
      path: Preferences/com.apple.dock.plist
    ~/Library/Preferences/com.apple.LaunchServices:
      force: true
      path: Preferences/com.apple.LaunchServices
    ~/Library/LaunchAgents/com.kibiz0r.sync_music.plist: LaunchAgents/com.kibiz0r.sync_music.plist

- shell:
  - [launchctl load ~/Library/LaunchAgents/com.kibiz0r.sync_music.plist, Launching com.kibiz0r.sync_music]
  - [killall cfprefsd, Relaunching prefs cache]
  - [killall Finder, Relaunching Finder]
  - [killall Dock, Relaunching Dock]
  - [killall SystemUIServer, Relaunching SystemUIServer]
  # Run SIP-phobic tasks last so they can complain if SIP needs to be temporarily disabled
  - [./hide_spotlight_icon, Hiding Spotlight icon]
  - [./check_sip_status, Checking SIP status]
