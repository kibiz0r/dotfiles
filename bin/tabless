#!/usr/bin/env bash

TAB_COLOR=$'\e[48;5;236m'
DINGLEBERRY_COLOR=$'\e[48;5;52m'
RESET_BG_COLOR=$'\e[49m'

IFS=: read MY_FILE MY_LINE <<< "${@: -1}"

MY_OPTS_LENGTH=${#@}
MY_OPTS_LENGTH=$((MY_OPTS_LENGTH > 1 ? MY_OPTS_LENGTH : 0))
MY_OPTS=${@::MY_OPTS_LENGTH}

if [[ -n $MY_LINE ]]; then
  MY_OPTS="$MY_OPTS +$MY_LINE"
fi

cat $MY_FILE |
    perl -pe "s/(\t+)(?![ \t]*$)/$(echo $TAB_COLOR)\1$(echo $RESET_BG_COLOR)/g" |
    perl -pe "s/([ \t]+(?:\\e\\[[\\d;]+m[ \t]*)*)\$/$(echo $DINGLEBERRY_COLOR)\1$(echo $RESET_BG_COLOR)/g" |
    less $MY_OPTS
