#!/usr/bin/env zsh

output=$( curl -sw "\n%{http_code}" $@ )
exitcode=$?
response=$( echo $output | ghead -n -1 )

if [[ $exitcode == 0 ]]; then
  statuscode=$( echo $output | tail -1 )

  if [[ ! -f $HOME/.httpcat$statuscode ]]; then
    curl -so $HOME/.httpcat$statuscode https://http.cat/$statuscode
  fi

  imgcat $HOME/.httpcat$statuscode 1>&2
fi

echo $response

exit $exitcode